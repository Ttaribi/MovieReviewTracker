<%- include('partials/header', { title: 'All Reviews', activePage: 'reviews' }) %>

<section class="hero" style="padding: 2.5rem 0;">
  <div class="container">
    <h1>All Reviews</h1>
    <p>Browse all movie reviews from our community</p>
  </div>
</section>

<section class="section">
  <div class="container">
    <% if (reviews && reviews.length > 0) { %>
      <div class="cards-grid">
        <% reviews.forEach(review => { %>
          <div class="review-card" data-review-id="<%= review._id %>">
            <div class="review-card-header">
              <% if (review.movieId) { %>
                <a href="/movie/<%= review.movieId.imdbID %>" class="review-card-poster">
                  <% if (review.movieId.poster && review.movieId.poster !== 'N/A') { %>
                    <img src="<%= review.movieId.poster %>" alt="<%= review.movieId.title %>">
                  <% } else { %>
                    <div class="no-poster" style="width:100%;height:100%;display:flex;align-items:center;justify-content:center;background:var(--bg-secondary);">üé¨</div>
                  <% } %>
                </a>
              <% } %>
              <div class="review-card-meta">
                <h3>
                  <% if (review.movieId) { %>
                    <a href="/movie/<%= review.movieId.imdbID %>"><%= review.movieId.title %></a>
                  <% } else { %>
                    Unknown Movie
                  <% } %>
                </h3>
                <p class="reviewer">by <%= review.reviewerName %></p>
                <div class="rating">
                  <% for (let i = 1; i <= 5; i++) { %>
                    <span class="star <%= i <= review.rating ? 'filled' : '' %>">‚òÖ</span>
                  <% } %>
                </div>
              </div>
            </div>
            <p class="review-card-comment"><%= review.comment.length > 150 ? review.comment.substring(0, 150) + '...' : review.comment %></p>
            <div class="review-card-footer">
              <span class="review-date"><%= new Date(review.createdAt).toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' }) %></span>
              <button class="delete-btn" onclick="deleteReview('<%= review._id %>')">Delete</button>
            </div>
          </div>
        <% }) %>
      </div>
    <% } else { %>
      <div class="empty-state">
        <div class="empty-state-icon">üìù</div>
        <h3>No reviews yet</h3>
        <p>Be the first to leave a review!</p>
        <a href="/" class="btn btn-primary" style="margin-top: 1rem;">Search Movies</a>
      </div>
    <% } %>
  </div>
</section>

<script>
  async function deleteReview(reviewId) {
    if (!confirm('Are you sure you want to delete this review?')) return;
    
    try {
      const res = await fetch(`/api/reviews/${reviewId}`, { method: 'DELETE' });
      const data = await res.json();
      
      if (data.success) {
        const card = document.querySelector(`[data-review-id="${reviewId}"]`);
        if (card) {
          card.style.transition = 'opacity 0.2s, transform 0.2s';
          card.style.opacity = '0';
          card.style.transform = 'scale(0.9)';
          setTimeout(() => card.remove(), 200);
        }
      } else {
        alert('Failed to delete review');
      }
    } catch (err) {
      alert('Failed to delete review');
    }
  }
</script>

<%- include('partials/footer') %>

